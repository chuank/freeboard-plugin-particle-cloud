<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Freeboard-plugin-particle-local by chuank</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Freeboard-plugin-particle-local</h1>
        <p>freeboard.io plugins for local Particle cloud</p>

        <p class="view"><a href="https://github.com/chuank/freeboard-plugin-particle-local">View the Project on GitHub <small>chuank/freeboard-plugin-particle-local</small></a></p>


        <ul>
          <li><a href="https://github.com/chuank/freeboard-plugin-particle-local/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/chuank/freeboard-plugin-particle-local/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/chuank/freeboard-plugin-particle-local">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h1>

<p>A simple plugin for the <a href="https://github.com/Freeboard/freeboard"><strong>freeboard.io</strong></a> dashboard that allows data from Particle devices to be exposed on a <a href="https://github.com/spark/spark-server"><strong>local Particle cloud</strong></a>.</p>

<p>The original work for this plugin was authored by <strong><a href="https://github.com/krvarma" class="user-mention">@krvarma</a></strong> and <a href="https://community.particle.io/t/cool-looking-dashboard-for-connected-devices/4021/27"><strong>posted on the Particle.io community forum</strong></a>. That version provided SSEs (Server-Sent-Events) between the <strong>Particle.io</strong> cloud (non-local) and a locally-installed [<strong>freeboard.io</strong>] dashboard.</p>

<p>At the time of writing, the local Particle cloud can only broadcast SSEs at the following levels:</p>

<ul>
<li>
<strong>Firehose</strong> (e.g. <a href="http://particle.local:8080/v1/events">http://particle.local:8080/v1/events</a>)</li>
<li>
<strong>Event-specific</strong> (e.g. <a href="http://particle.local:8080/v1/events/%5BeventName%5D">http://particle.local:8080/v1/events/[eventName]</a>)</li>
<li>
<del>Device-specific Firehose</del> (e.g. <a href="http://particle.local:8080/v1/devices/%5BdeviceID%5D/events">http://particle.local:8080/v1/devices/[deviceID]/events</a>)</li>
<li>
<del>Device-specific, event-specific</del> (e.g. <a href="http://particle.local:8080/v1/devices/%5BdeviceID%5D/events/%5BeventName%5D">http://particle.local:8080/v1/devices/[deviceID]/events/[eventName]</a>)</li>
</ul>

<p>This repository is created to host freeboard plugins that address the above differences between <strong>Particle.io</strong> and locally-installed clouds. </p>

<hr>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>Follow the <a href="http://freeboard.github.io/freeboard/docs/plugin_example.html"><strong>instructions on freeboard.io</strong></a> to install the plugin.</p>

<p>At this time time, there is only one plugin available:</p>

<ul>
<li><code>particleLocalSSE.js</code></li>
</ul>

<hr>

<h1>
<a id="usage-setting-up-a-datasource" class="anchor" href="#usage-setting-up-a-datasource" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage: Setting up a datasource</h1>

<p>Add the <strong>Particle Local SSE</strong> datasource as you would normally do on freeboard.io.</p>

<p>The fields in the dialog box are self-explanatory. Take note to provide the <strong>full local url</strong> for your local Particle cloud and port number. For example: <strong><code>http://particle.local:8080</code></strong></p>

<p>In the <strong>Event</strong> text field, enter the SSE event name you want to track. This field should contain the same string as your Particle Build/Dev code:</p>

<pre><code>Spark.publish("eventName", String(eventValue), 5, PRIVATE);
</code></pre>

<p><em>(Note: there's no practical difference between PRIVATE / PUBLIC events on a local cloud!)</em></p>

<p>Once OK'ed, you should get the SSE working and updating itself automatically to your freeboard every time a new event gets called by your Particle devices.</p>

<hr>

<h1>
<a id="usage-linking-your-datasource-to-a-widget" class="anchor" href="#usage-linking-your-datasource-to-a-widget" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage: Linking your datasource to a widget</h1>

<p>This really depends on how you are publishing your variables from Particle, but a suggested approach is to compile as many readings as needed into a JSON string (be sure to check the 63-byte limit for both event name and data strings), and send that as a single publish request to minimise the number of events being published.</p>

<p><em>Take note: the local Particle cloud by default limits the publish frequency to 1Hz, or a burst of 4 messages every 4 seconds.</em></p>

<h2>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example:</h2>

<p>A publish request in Particle Build/Dev for a temperature/humidity sensor might look like:</p>

<pre><code>tempC = DHT22.getCelsius();
humidity = DHT22.getHumidity();
sprintf(pubOut, "{\"c\":\"%2.2f\",\"h\":\"%2.2f\"}", tempC, humidity);
Spark.publish("dht22", pubOut, 5, PUBLIC);
</code></pre>

<p>Working from the above example, the data received in a freeboard widget will require some additional JSON parsing, which can be easily done in the freeboard .JS editor as:</p>

<pre><code>var d = JSON.parse(datasources["SSE"]["data"]);
return d["c"];
</code></pre>

<p>If you are not publishing JSON data from Particle Build/Dev and only need to publish a single string value, retrieving this is even easier:</p>

<pre><code>datasources["SSE"]["data"]);
</code></pre>

<p>In addition, you can also parse the metadata included with each SSE:</p>

<pre><code>datasources["SSE"]["coreid"]
</code></pre>

<p>or</p>

<pre><code>var dateObj = new Date(datasources["SSE"]["published_at"]);
return dateObj.getHours();
</code></pre>

<hr>

<h1>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Authors and Contributors</h1>

<p>Original plugin: 2014 Krishnaraj Varma (<a href="https://github.com/krvarma" class="user-mention">@krvarma</a>)<br>
Particle local cloud adaptation and instructions: 2015 Chuan Khoo (<a href="https://github.com/chuank" class="user-mention">@chuank</a>)</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/chuank">chuank</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
